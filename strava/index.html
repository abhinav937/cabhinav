<!DOCTYPE html>
<html lang="en" class="strava-page">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strava Activities | Abhinav Chinnusamy</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Explore Abhinav Chinnusamy's Strava running activities and performance metrics.">
    <meta name="keywords" content="Abhinav Chinnusamy, Strava, Running, Fitness, Activity Summary">
    <meta name="author" content="Abhinav Chinnusamy">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

    <!-- Geo-location Tags -->
    <meta name="geo.region" content="US-WI" />
    <meta name="geo.placename" content="Madison, Wisconsin" />
    <meta name="geo.position" content="43.0731;-89.4012" />
    <meta name="ICBM" content="43.0731, -89.4012" />

    <!-- Language Targeting -->
    <link rel="alternate" hreflang="en-US" href="https://cabhinav.com/strava/" />
    <link rel="alternate" hreflang="x-default" href="https://cabhinav.com/strava/" />

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Strava Activities - Abhinav Chinnusamy">
    <meta property="og:description" content="Explore my running journey with activity summaries, latest rides, and upcoming races">
    <meta property="og:image" content="https://cabhinav.com/assets/images/social/strava-twitter-card.jpg">
    <meta property="og:url" content="https://cabhinav.com/strava">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Strava Activities - Abhinav Chinnusamy">
    <meta name="twitter:description" content="Running activities, performance metrics, and race tracking">
    <meta name="twitter:image" content="https://cabhinav.com/assets/images/social/strava-twitter-card.jpg">
    <meta name="twitter:creator" content="@emotor">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://cabhinav.com/strava/">

    <!-- Theme Color -->
    <meta name="theme-color" content="#161618">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="../assets/images/icons/favicon.ico">

    <!-- Favicon -->
    <link rel="icon" href="../assets/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../assets/images/icons/favicon.ico" type="image/x-icon">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Grok Styles -->
    <link rel="stylesheet" href="../assets/css/grok-style.css">

    <!-- Page Specific Styles -->
    <link rel="stylesheet" href="../assets/css/strava.css">
    
    <!-- Stat Dashboard Styles -->
    <link rel="stylesheet" href="../web-components/stat-dashboard/style.css">
    
    <!-- Space Background -->
    <script src="../assets/js/enhanced-space-background.js"></script>
    <link rel="stylesheet" href="../assets/css/space-background.css">

    <!-- Breadcrumb Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://cabhinav.com/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Strava Activities",
          "item": "https://cabhinav.com/strava/"
        }
      ]
    }
    </script>
</head>

<body class="strava-page">
    <!-- Space Background Canvas -->
    <div id="space-background-container"></div>

    <div class="strava-container">
        <!-- Header Section -->
        <header class="strava-hero">
            <h1 class="strava-title">Strava Activities</h1>
            <p class="strava-subtitle">Track my running journey and performance metrics</p>
        </header>

        <!-- Main Content Grid - All Three Sections -->
        <div class="strava-main-grid">
            <!-- Personal Bests Dashboard -->
            <section class="strava-pb-section" aria-label="Personal Best Times">
                <!-- Sortable Stat Dashboard -->
                <div class="stat-dashboard sortable-dashboard dashboard-hidden">
                        <div class="dashboard-header">
                            <div class="stat-icon">
                                <span class="material-symbols-outlined">emoji_events</span>
                            </div>
                            <h2>Personal Best Times</h2>
                            <div class="sort-controls">
                                <button class="sort-btn" data-sort="distance" data-order="asc" title="Sort by Distance">
                                    <span class="sort-label">Distance</span>
                                    <span class="material-symbols-outlined sort-icon">unfold_more</span>
                                </button>
                                <button class="sort-btn" data-sort="pace" data-order="asc" title="Sort by Pace">
                                    <span class="sort-label">Pace</span>
                                    <span class="material-symbols-outlined sort-icon">unfold_more</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="stats-list" id="sortable-stats-list">
                            <!-- 400m -->
                            <div class="stat-card" data-type="pb" data-distance="400m">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">400m</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- Half Mile -->
                            <div class="stat-card" data-type="pb" data-distance="halfmi">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">Half Mile</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/mi</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 1K -->
                            <div class="stat-card" data-type="pb" data-distance="1k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">1K</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 1 Mile -->
                            <div class="stat-card" data-type="pb" data-distance="1mi">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">1 Mile</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/mi</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 2 Mile -->
                            <div class="stat-card" data-type="pb" data-distance="2mi">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">2 Mile</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/mi</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 5K -->
                            <div class="stat-card highlight" data-type="pb" data-distance="5k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">5K</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 10K -->
                            <div class="stat-card" data-type="pb" data-distance="10k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">10K</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 15K -->
                            <div class="stat-card" data-type="pb" data-distance="15k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">15K</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 10 Mile -->
                            <div class="stat-card" data-type="pb" data-distance="10mi">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">10 Mile</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/mi</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- 20K -->
                            <div class="stat-card" data-type="pb" data-distance="20k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">20K</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- Half Marathon -->
                            <div class="stat-card highlight" data-type="pb" data-distance="21k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">Half Marathon</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                            <!-- Marathon -->
                            <div class="stat-card" data-type="pb" data-distance="42k">
                                <div class="stat-row">
                                    <div class="stat-icon"><span class="material-symbols-outlined">emoji_events</span></div>
                                    <div class="stat-label">Marathon</div>
                                    <div class="stat-main-info">
                                        <div class="stat-value" data-format="time">--:--</div>
                                        <div class="stat-pace">Pace: <span>--:--</span>/km</div>
                                    </div>
                                    <div class="stat-date">Achieved: <span>Loading...</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
            </section>

            <!-- Widgets Section -->
            <section class="strava-widgets" aria-label="Strava Activity Widgets">
            <!-- Latest Activities -->
            <div class="strava-widget">
                <h2 class="strava-section-title">
                    <span class="material-symbols-outlined">route</span>
                    Latest Activities
                </h2>
                <div class="strava-widget-content">
                    <iframe
                        class="strava-iframe latest-rides"
                        height="300"
                        width="300"
                        style="border: none;"
                        allow="fullscreen"
                        loading="lazy"
                        title="Latest Strava Activities"
                        src="https://www.strava.com/athletes/99464226/latest-rides/63bde6a12ff1a11fb4436df5e6a8aac6b8ebb32c"
                        aria-label="Latest Strava running activities">
                    </iframe>
                </div>
            </div>

            <!-- My Half Marathon -->
            <div class="strava-widget">
                <h2 class="strava-section-title">
                    <span class="material-symbols-outlined">emoji_events</span>
                    My Half Marathon
                </h2>
                <div class="strava-widget-content">
                    <div class="strava-embed-placeholder" data-embed-type="activity" data-embed-id="16406693132" data-style="standard" data-from-embed="false"></div><script src="https://strava-embeds.com/embed.js"></script>
                </div>
            </div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="https://x.com/emotor" target="_blank" class="footer-link">
                        <img src="../assets/images/social/x-svg.svg" alt="X (Twitter)" class="footer-icon-svg">
                    </a>
                    <a href="https://github.com/abhinav937" target="_blank" class="footer-link">
                        <span class="material-symbols-outlined">code</span>
                    </a>
                    <a href="https://scholar.google.com/citations?user=40h4Uo8AAAAJ&hl=en" target="_blank" class="footer-link">
                        <span class="material-symbols-outlined">school</span>
                    </a>
                    <a href="https://www.strava.com/athletes/99464226" target="_blank" class="footer-link">
                        <span class="material-symbols-outlined">directions_run</span>
                    </a>
                </div>

                <p class="footer-text">Â© 2025 Abhinav Chinnusamy. Power Electronics Engineer.</p>
            </div>
        </div>
    </footer>

  <!-- Scripts -->
  <script>
    // API Configuration
    const STRAVA_API_BASE = 'https://ai-reply-bot.vercel.app/api/strava/personal-bests';

    // Handle OAuth callback if redirected here
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const authCode = urlParams.get('code');
      const authError = urlParams.get('error');

      if (authError) {
        window.history.replaceState({}, document.title, window.location.pathname);
      } else if (authCode) {
        // Check if we already processed this code (prevent double processing)
        const processedCodes = JSON.parse(localStorage.getItem('processedAuthCodes') || '[]');
        if (processedCodes.includes(authCode)) {
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }

        // Exchange code for token via API
        exchangeAuthCode(authCode).then(() => {
          // Mark code as processed
          processedCodes.push(authCode);
          localStorage.setItem('processedAuthCodes', JSON.stringify(processedCodes.slice(-5))); // Keep last 5
          window.history.replaceState({}, document.title, window.location.pathname);
        }).catch(error => {
          // Authorization failed silently
        });
      }
    })();

    // Exchange authorization code for token
    async function exchangeAuthCode(code) {
      try {
        const response = await fetch(STRAVA_API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code: code })
        });

        const data = await response.json();

        if (data.success) {
          localStorage.setItem('stravaAuthorized', 'true');
          localStorage.setItem('stravaAuthTime', Date.now().toString());
          // Reload personal bests data
          loadPersonalBests();
        } else {
          throw new Error(data.message || 'Authorization failed');
        }
      } catch (error) {
        throw error;
      }
    }


    // Load personal bests data from API
    async function loadPersonalBests() {
      try {
        const response = await fetch(STRAVA_API_BASE);
        const data = await response.json();

        if (data.success) {
          updatePersonalBests(data.data.personal_bests);
          hideSetupMessage();
        } else if (data.setup_required) {
          showSetupMessage();
        } else {
          // API Error occurred
        }
      } catch (error) {
        showSetupMessage();
      }
    }

    // Update personal bests display with real data
    function updatePersonalBests(personalBests) {
      const distanceMapping = {
        '400m': '400m',
        'half_mile': 'halfmi',
        '1km': '1k',
        '1_mile': '1mi',
        '2_mile': '2mi',
        '5km': '5k',
        '10km': '10k',
        '15km': '15k',
        '10_mile': '10mi',
        '20km': '20k',
        'half_marathon': '21k',
        'marathon': '42k'
      };

      Object.entries(personalBests).forEach(([key, pb]) => {
        const htmlDistance = distanceMapping[key];
        if (!htmlDistance) return;

        const card = document.querySelector(`[data-distance="${htmlDistance}"]`);
        if (!card) return;

        const pbData = pb as any;
        const timeValue = card.querySelector('.stat-value');
        const paceValue = card.querySelector('.stat-pace span');
        const dateValue = card.querySelector('.stat-date span');

        if (timeValue) {
          timeValue.textContent = pbData.time_formatted;
          timeValue.setAttribute('data-target-seconds', pbData.time_seconds);
        }

        if (paceValue) {
          paceValue.textContent = pbData.pace_per_km;
        }

        if (dateValue) {
          const date = new Date(pbData.start_date_local).toLocaleDateString();
          dateValue.textContent = date;
        }
      });

      // Show the dashboard
      const dashboard = document.querySelector('.stat-dashboard');
      if (dashboard) {
        dashboard.classList.remove('dashboard-hidden');
      }
    }

    // Show setup message when not configured
    function showSetupMessage() {
      const dashboard = document.querySelector('.stat-dashboard');
      if (dashboard) {
        dashboard.classList.add('dashboard-hidden');
      }

      // Remove existing setup message if any
      const existing = document.querySelector('.setup-message');
      if (existing) existing.remove();

      const setupDiv = document.createElement('div');
      setupDiv.className = 'setup-message';
      setupDiv.style.cssText = `
        text-align: center;
        padding: 40px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
      `;

      setupDiv.innerHTML = `
        <h3 style="color: #fff; margin-bottom: 16px; font-size: 1.5em;">ðŸš€ Setup Required</h3>
        <p style="color: #ccc; margin-bottom: 24px; font-size: 1.1em;">
          Connect your Strava account to view your personal bests
        </p>
        <a href="https://www.strava.com/oauth/authorize?client_id=143887&response_type=code&redirect_uri=https://cabhinav.com/strava/&approval_prompt=force&scope=read,activity:read"
           style="display: inline-block; background: #FC4C02; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s;"
           onmouseover="this.style.background='#E04302'"
           onmouseout="this.style.background='#FC4C02'">
          ðŸ”— Connect Strava
        </a>
      `;

      const container = document.querySelector('.strava-pb-section');
      if (container) {
        container.appendChild(setupDiv);
      }
    }

    // Hide setup message
    function hideSetupMessage() {
      const setupMsg = document.querySelector('.setup-message');
      if (setupMsg) {
        setupMsg.remove();
      }
    }

    // Suppress Strava embed errors
    (function() {
      const originalError = window.onerror;
      window.onerror = function(msg, url, line, col, error) {
        // Suppress all Strava-related errors - more aggressive filtering
        const isStravaError = msg && (
          msg.includes('strava') ||
          msg.includes('Failed to read a named property') ||
          msg.includes('Cannot set properties of undefined') ||
          msg.includes('Cannot read properties of undefined') ||
          msg.includes('Unexpected identifier') ||
          msg.includes('windowOnloadTriggered') ||
          msg.includes('loadCDNiFrame') ||
          url && (url.includes('strava') || url.includes('uc.js'))
        );

        if (isStravaError) {
          return true; // Suppress these errors
        }

        if (originalError) {
          return originalError.call(this, msg, url, line, col, error);
        }
        return false;
      };
    })();
    
    // Initialize Space Background - Same config as main page
    document.addEventListener('DOMContentLoaded', function() {
      const spaceContainer = document.getElementById('space-background-container');
      if (spaceContainer && window.initEnhancedSpaceBackground) {
        const config = {
          enableControls: false,
          mobileOptimizations: true,
          targetFps: 60,
          enableNebula: true,
          enableStarlinkTrains: false,
          starDensity: 0.5,
          shootingStarFreq: 0.001,
          nebulaCount: 0,
          animationSpeed: 1.2
        };
        window.initEnhancedSpaceBackground(spaceContainer, config);
      }

      // Load personal bests data
      loadPersonalBests();
    });
    
  </script>
  
  <!-- Stat Dashboard Script -->
  <script src="../web-components/stat-dashboard/script.js" defer></script>
</body>
</html> 