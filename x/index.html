<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>X Posts</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(to bottom, #e6f0fa, #f5f8fa);
      min-height: 100vh;
    }

    .posts-container {
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 16px 0;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .posts-container::-webkit-scrollbar {
      height: 8px;
    }
    .posts-container::-webkit-scrollbar-thumb {
      background: #c4c9cc;
      border-radius: 4px;
    }
    .posts-container::-webkit-scrollbar-track {
      background: #e6ecf0;
    }

    .post {
      flex: 0 0 370px; /* Changed from 300px to 400px */
      background: #fff;
      border: 1px solid #e6ecf0;
      border-radius: 16px;
      padding: 16px 20px;
      margin-right: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      opacity: 0;
      transform: translateX(20px);
      scroll-snap-align: start;
    }

    .post.visible {
      opacity: 1;
      transform: translateX(0);
      animation: slideInHorizontal 0.5s ease-out forwards;
    }

    .post:hover {
      background: #f8fafc;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      transform: translateY(-4px);
    }

    @keyframes slideInHorizontal {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .post-text {
      font-size: 15px;
      line-height: 22px;
      color: #0f1419;
      white-space: pre-wrap;
    }

    .post-text a {
      color: #1da1f2;
      text-decoration: none;
      position: relative;
    }
    .post-text a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: #1da1f2;
      transition: width 0.3s ease;
    }
    .post-text a:hover::after {
      width: 100%;
    }

    .post-date {
      font-size: 13px;
      color: #536471;
      margin-top: 4px;
    }

    .post-media img {
      max-width: 100%;
      height: auto;
      border-radius: 12px;
      margin-top: 12px;
      border: 1px solid #e6ecf0;
      transition: transform 0.3s ease;
    }
    .post-media img:hover {
      transform: scale(1.02);
    }

    .post-header {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }

    .post-header img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin-right: 12px;
    }

    .username {
      font-weight: 700;
      font-size: 15px;
      color: #0f1419;
    }

    .handle {
      font-size: 15px;
      color: #536471;
      margin-left: 4px;
    }

    .cache-note {
      font-size: 14px;
      color: #536471;
      text-align: center;
      background: rgba(255, 255, 255, 0.8);
      padding: 8px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .scroll-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
    }

    .scroll-button {
      background: #1da1f2;
      color: white;
      padding: 8px 16px;
      border-radius: 9999px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .scroll-button:hover {
      background: #1a91da;
    }

    .scroll-button:disabled {
      background: #c4c9cc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="max-w-4xl mx-auto px-4 py-6 container">
    <h1 class="text-3xl font-bold text-center text-gray-900 mb-4">My Latest X Posts</h1>
    <div class="cache-note">
      Posts are pre-fetched monthly to conserve the Free tier's 100-post monthly limit (10 requests at 10 posts each).
    </div>
    <div id="posts-container" class="posts-container"></div>
    <div class="scroll-buttons">
      <button id="scroll-left" class="scroll-button">← Previous</button>
      <button id="scroll-right" class="scroll-button">Next →</button>
    </div>
  </div>

  <script>async function loadTweets() {
  try {
    const response = await fetch('../x-proxy/tweets.json'); // Changed from './x-proxy/tweets.json' to '../x-proxy/tweets.json'
    if (!response.ok) throw new Error(`Failed to load tweets.json`);
    const data = await response.json();
    return { tweets: data.data || [], includes: data.includes || {} };
  } catch (e) {
    console.error('Error loading tweets:', e.message);
    return { tweets: [], includes: {} };
  }
}

  function renderPosts({ tweets, includes }) {
    const container = document.getElementById('posts-container');
    container.innerHTML = '';

    if (tweets.length === 0) {
      container.innerHTML = '<p class="text-center text-gray-600">No recent posts found.</p>';
      return;
    }

    const doubledTweets = [...tweets, ...tweets]; // Double for infinite scrolling
    const fallbackImg = 'https://pbs.twimg.com/profile_images/1927391280914386945/H7odsFKa_400x400.jpg';

    doubledTweets.forEach((tweet, i) => {
      const postEl = document.createElement('div');
      postEl.className = 'post';
      postEl.dataset.index = i;

      const user = includes.users?.find(u => u.id === tweet.author_id) || {
        name: 'Abhinav Chinnusamy',
        username: 'abhinav_937',
        profile_image_url: fallbackImg
      };

      const header = document.createElement('div');
      header.className = 'post-header';
      const img = document.createElement('img');
      img.src = user.profile_image_url;
      img.alt = 'Profile';
      header.appendChild(img);

      const info = document.createElement('div');
      const name = document.createElement('span');
      name.className = 'username';
      name.textContent = user.name;

      const handle = document.createElement('span');
      handle.className = 'handle';
      handle.textContent = `@${user.username}`;

      info.appendChild(name);
      info.appendChild(handle);
      header.appendChild(info);
      postEl.appendChild(header);

      // Text
      let text = tweet.text || '';
      if (tweet.entities?.mentions) {
        tweet.entities.mentions.forEach(m => {
          text = text.replace(new RegExp(`@${m.username}\\b`, 'g'), `<a href="https://twitter.com/${m.username}" target="_blank">@${m.username}</a>`);
        });
      }
      if (tweet.entities?.urls) {
        tweet.entities.urls.forEach(u => {
          text = text.replace(u.url, `<a href="${u.expanded_url}" target="_blank">${u.display_url}</a>`);
        });
      }

      const textEl = document.createElement('p');
      textEl.className = 'post-text';
      textEl.innerHTML = text;
      postEl.appendChild(textEl);

      // Date
      const date = document.createElement('div');
      date.className = 'post-date';
      date.textContent = new Date(tweet.created_at).toLocaleString('en-US', {
        month: 'short', day: 'numeric', year: 'numeric',
        hour: 'numeric', minute: '2-digit', hour12: true
      });
      postEl.appendChild(date);

      // Media
      if (tweet.attachments?.media_keys && includes.media) {
        const media = tweet.attachments.media_keys.map(k => includes.media.find(m => m.media_key === k)).filter(Boolean);
        media.forEach(m => {
          const mediaEl = document.createElement('div');
          mediaEl.className = 'post-media';
          const img = document.createElement('img');
          img.src = m.url || m.preview_image_url;
          img.alt = 'Media';
          img.loading = 'lazy';
          mediaEl.appendChild(img);
          postEl.appendChild(mediaEl);
        });
      }

      container.appendChild(postEl);
    });

    // Animate in
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          obs.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.post').forEach(el => observer.observe(el));

    // Scroll buttons functionality
    const scrollLeftBtn = document.getElementById('scroll-left');
    const scrollRightBtn = document.getElementById('scroll-right');
    const cardWidth = 400 + 16; // Changed from 300 + 16 to 400 + 16
    const originalLen = tweets.length;

    scrollLeftBtn.addEventListener('click', () => {
      container.scrollLeft -= cardWidth;
      if (container.scrollLeft <= 0) {
        container.scrollLeft += cardWidth * originalLen;
      }
    });

    scrollRightBtn.addEventListener('click', () => {
      container.scrollLeft += cardWidth;
      if (container.scrollLeft >= cardWidth * originalLen) {
        container.scrollLeft -= cardWidth * originalLen;
      }
    });

    // Update button states
    function updateButtonStates() {
      scrollLeftBtn.disabled = container.scrollLeft <= 0;
      scrollRightBtn.disabled = container.scrollLeft >= container.scrollWidth - container.clientWidth;
    }

    container.addEventListener('scroll', updateButtonStates);
    updateButtonStates();
  }

  async function main() {
    const data = await loadTweets();
    renderPosts(data);
  }

  main();
</script>
</body>
</html>